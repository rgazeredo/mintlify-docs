---
title: "Listar Mensagens da Campanha"
api: "POST /sender/listmessages"
description: "Obter mensagens de uma campanha específica"
---

Retorna a lista de mensagens de uma campanha específica, com opções de filtro por status e paginação. Ideal para monitorar progresso detalhado e rastrear entregas.

## Sobre Listagem de Mensagens

<AccordionGroup>
  <Accordion title="Detalhamento de Mensagens" icon="envelope">
    Visão granular de cada mensagem da campanha.

    **Informações Retornadas:**
    - ID único da mensagem
    - Destinatário (número WhatsApp)
    - Status atual da mensagem
    - Conteúdo e tipo da mensagem
    - Timestamps de criação e envio
    - Tentativas de envio
    - Erros se houver

    **Status de Mensagens:**
    - `scheduled`: Agendada para envio
    - `sending`: Em processo de envio
    - `sent`: Enviada com sucesso
    - `delivered`: Entregue ao destinatário
    - `read`: Lida pelo destinatário
    - `error`: Erro no envio
    - `failed`: Falha permanente

    **Uso Prático:**
    - Verificar status individual de entregas
    - Identificar mensagens com erro
    - Rastrear progresso da campanha
    - Reenviar mensagens falhadas
    - Gerar relatórios detalhados
  </Accordion>

  <Accordion title="Paginação de Resultados" icon="table-rows">
    Como navegar em listas grandes de mensagens.

    **Parâmetros de Paginação:**
    - `page`: Número da página (inicia em 1)
    - `pageSize`: Quantidade de itens por página
    - Padrão: página 1, 50 itens

    **Cálculo de Páginas:**
    ```
    Total de mensagens: 250
    pageSize: 50

    Página 1: mensagens 1-50
    Página 2: mensagens 51-100
    Página 3: mensagens 101-150
    Página 4: mensagens 151-200
    Página 5: mensagens 201-250
    ```

    **Boas Práticas:**
    - Começar com pageSize moderado (50-100)
    - Ajustar conforme performance
    - Implementar scroll infinito ou botões de navegação
    - Cachear páginas já carregadas
    - Mostrar indicador de progresso

    **Metadados Retornados:**
    - Total de mensagens
    - Página atual
    - Total de páginas
    - Tem próxima página
    - Tem página anterior
  </Accordion>

  <Accordion title="Filtros por Status" icon="filter">
    Como filtrar mensagens por estado.

    **Filtros Disponíveis:**
    - Sem filtro: Retorna todas
    - `scheduled`: Apenas agendadas
    - `sent`: Apenas enviadas
    - `delivered`: Apenas entregues
    - `error`: Apenas com erro
    - Múltiplos: Separar por vírgula

    **Casos de Uso:**
    - `error` → Identificar problemas para reenvio
    - `delivered` → Confirmar entregas bem-sucedidas
    - `scheduled` → Ver mensagens pendentes
    - `sent` → Mensagens enviadas mas não confirmadas

    **Combinação com Paginação:**
    ```javascript
    // Primeira página de mensagens com erro
    { folder_id: "123", messageStatus: "error", page: 1, pageSize: 20 }

    // Segunda página de mensagens entregues
    { folder_id: "123", messageStatus: "delivered", page: 2, pageSize: 50 }
    ```
  </Accordion>

  <Accordion title="Casos de Uso" icon="lightbulb">
    Aplicações práticas da listagem detalhada.

    **Monitoramento em Tempo Real:**
    - Dashboard de progresso da campanha
    - Gráficos de taxa de entrega
    - Alertas de mensagens com erro
    - Estatísticas de leitura

    **Troubleshooting:**
    - Identificar destinatários com problema
    - Analisar padrões de falha
    - Validar números inválidos
    - Detectar bloqueios

    **Reenvio Seletivo:**
    - Listar mensagens com erro
    - Reenviar apenas falhadas
    - Atualizar números incorretos
    - Criar nova campanha com não entregues

    **Relatórios:**
    - Exportar lista completa
    - Gerar CSV de entregas
    - Análise de performance
    - Auditoria de envios
  </Accordion>
</AccordionGroup>

### Authorizations

<ParamField path="token" type="string" required>
  Token de autenticação de conexão com a API. <br />
  Exemplo: `zt_BppKZWtzvj1X2SbJAuOSkA0Z63uDBQ0wkb28NJaloKeOUnHk`
</ParamField>

### Body Parameters

<ParamField path="folder_id" type="string" required>
  ID da campanha a ser consultada. <br />
  Obtido ao criar campanha ou listar folders. <br />
  Exemplo: `"folder_123"`
</ParamField>

<ParamField path="messageStatus" type="string">
  Filtrar por status da mensagem. <br />
  **Valores:** `scheduled`, `sending`, `sent`, `delivered`, `read`, `error`, `failed` <br />
  Omitir para retornar todas. <br />
  Exemplo: `"delivered"`
</ParamField>

<ParamField path="page" type="integer">
  Número da página para paginação. <br />
  Inicia em 1. <br />
  Padrão: `1` <br />
  Exemplo: `2`
</ParamField>

<ParamField path="pageSize" type="integer">
  Quantidade de itens por página. <br />
  Padrão: `50` <br />
  Máximo recomendado: `100` <br />
  Exemplo: `50`
</ParamField>

<Info>
  Use paginação para campanhas com muitas mensagens. Listar tudo de uma vez pode causar timeout ou alto consumo de memória.
</Info>

<RequestExample>
```bash cURL
curl -X POST https://zapclass.com.br/api/sender/listmessages \
  -H "Content-Type: application/json" \
  -H "Token: zt_BppKZWtzvj1X2SbJAuOSkA0Z63uDBQ0wkb28NJaloKeOUnHk" \
  -d '{
    "folder_id": "folder_123"
  }'
```

```javascript JavaScript
const response = await fetch("https://zapclass.com.br/api/sender/listmessages", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    Token: "zt_BppKZWtzvj1X2SbJAuOSkA0Z63uDBQ0wkb28NJaloKeOUnHk",
  },
  body: JSON.stringify({
    folder_id: "folder_123"
  }),
});

const data = await response.json();
if (data.success) {
  console.log(`Total: ${data.total}`);
  console.log(`Página ${data.page} de ${data.totalPages}`);
  data.messages.forEach(msg => {
    console.log(`- ${msg.to}: ${msg.status}`);
  });
}
```

```php PHP
<?php
$ch = curl_init('https://zapclass.com.br/api/sender/listmessages');

$payload = [
    "folder_id" => "folder_123"
];

curl_setopt($ch, CURLOPT_POST, 1);
curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($payload));
curl_setopt($ch, CURLOPT_HTTPHEADER, [
    'Content-Type: application/json',
    'Token: zt_BppKZWtzvj1X2SbJAuOSkA0Z63uDBQ0wkb28NJaloKeOUnHk'
]);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);

$response = curl_exec($ch);
$data = json_decode($response, true);

if ($data['success']) {
    echo "Total: {$data['total']}\n";
    echo "Página {$data['page']} de {$data['totalPages']}\n";
    foreach ($data['messages'] as $msg) {
        echo "- {$msg['to']}: {$msg['status']}\n";
    }
} else {
    echo "Erro: " . $data['message'];
}

curl_close($ch);
?>
```
</RequestExample>

<ResponseExample>
```json 200
{
  "success": true,
  "folder_id": "folder_123",
  "page": 1,
  "pageSize": 50,
  "total": 150,
  "totalPages": 3,
  "messages": [
    {
      "id": "msg_001",
      "to": "5511999999999@s.whatsapp.net",
      "status": "delivered",
      "type": "text",
      "text": "Olá! Temos uma oferta especial",
      "sentAt": 1672531200000,
      "deliveredAt": 1672531215000
    },
    {
      "id": "msg_002",
      "to": "5511888888888@s.whatsapp.net",
      "status": "sent",
      "type": "text",
      "text": "Confira nossa promoção",
      "sentAt": 1672531230000
    },
    {
      "id": "msg_003",
      "to": "5511777777777@s.whatsapp.net",
      "status": "error",
      "type": "text",
      "text": "Mensagem de teste",
      "error": "Invalid phone number",
      "attempts": 3
    }
  ]
}
```

```json 200
{
  "success": true,
  "folder_id": "folder_123",
  "page": 1,
  "pageSize": 50,
  "total": 5,
  "totalPages": 1,
  "messages": [
    {
      "id": "msg_010",
      "to": "5511777777777@s.whatsapp.net",
      "status": "error",
      "type": "text",
      "text": "Teste",
      "error": "Invalid phone number",
      "attempts": 3,
      "lastAttempt": 1672531500000
    },
    {
      "id": "msg_015",
      "to": "5511666666666@s.whatsapp.net",
      "status": "error",
      "type": "image",
      "file": "https://exemplo.com/img.jpg",
      "error": "Media download failed",
      "attempts": 2,
      "lastAttempt": 1672531600000
    }
  ]
}
```

```json 200
{
  "success": true,
  "folder_id": "folder_123",
  "page": 1,
  "pageSize": 50,
  "total": 0,
  "totalPages": 0,
  "messages": []
}
```

</ResponseExample>
