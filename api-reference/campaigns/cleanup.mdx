---
title: "Limpar Mensagens Enviadas"
api: "POST /sender/cleardone"
description: "Remover mensagens antigas de campanhas concluídas"
---

Inicia processo de limpeza de mensagens antigas em lote que já foram enviadas com sucesso. Por padrão, remove mensagens mais antigas que 7 dias (168 horas).

## Sobre Limpeza de Mensagens

<AccordionGroup>
  <Accordion title="O que é a Limpeza Automática" icon="broom">
    Sistema de manutenção para otimizar armazenamento.

    **Funcionamento:**
    - Remove mensagens com status "done" (enviadas)
    - Critério baseado em idade da mensagem
    - Padrão: mensagens com mais de 7 dias (168h)
    - Processo executado de forma assíncrona
    - Não afeta mensagens pendentes ou em envio

    **Benefícios:**
    - Libera espaço no banco de dados
    - Melhora performance de consultas
    - Reduz custos de armazenamento
    - Mantém apenas dados recentes e relevantes
    - Preserva histórico conforme necessário

    **O que é removido:**
    - Mensagens com status "done"
    - Mais antigas que o período especificado
    - Metadados e registros relacionados
    - Links e referências obsoletas
  </Accordion>

  <Accordion title="Configuração do Período" icon="clock">
    Como definir tempo de retenção de mensagens.

    **Parâmetro `hours`:**
    - Define idade máxima das mensagens
    - Padrão: 168 horas (7 dias)
    - Valor em horas (inteiro)
    - Calculado a partir do momento atual

    **Exemplos de Períodos:**
    - 24 horas (1 dia): `hours: 24`
    - 168 horas (7 dias): `hours: 168` (padrão)
    - 720 horas (30 dias): `hours: 720`
    - 2160 horas (90 dias): `hours: 2160`
    - 8760 horas (1 ano): `hours: 8760`

    **Cálculo:**
    ```
    Mensagem enviada em: 01/01/2024 10:00
    Hora atual: 10/01/2024 10:00
    Idade: 216 horas (9 dias)

    hours: 168 → Remove (216 > 168)
    hours: 240 → Mantém (216 < 240)
    ```

    **Recomendações:**
    - Campanhas regulares: 7-15 dias
    - Campanhas importantes: 30-90 dias
    - Auditoria/compliance: 1+ ano
    - Testes e desenvolvimento: 1-3 dias
  </Accordion>

  <Accordion title="Processo Assíncrono" icon="arrows-rotate">
    Como funciona a execução da limpeza.

    **Etapas do Processo:**
    1. API recebe requisição
    2. Valida parâmetros
    3. Retorna confirmação imediata
    4. Executa limpeza em background
    5. Remove mensagens elegíveis
    6. Atualiza contadores e índices

    **Características:**
    - Não bloqueia operações
    - Execução paralela permitida
    - Sem timeout ou limite de tempo
    - Conclusão silenciosa (sem notificação)
    - Pode levar de segundos a minutos

    **Importante:**
    - Não há callback de conclusão
    - Não retorna quantidade removida
    - Processo não pode ser cancelado
    - Evite executar com muita frequência
    - Aguarde alguns minutos entre execuções
  </Accordion>

  <Accordion title="Boas Práticas" icon="thumbs-up">
    Recomendações para uso eficiente.

    **Quando Executar:**
    - Periodicamente (semanal ou mensal)
    - Após grandes campanhas
    - Antes de backups importantes
    - Durante janelas de manutenção
    - Quando perceber lentidão

    **Quando Não Executar:**
    - Durante campanhas ativas
    - Em horários de pico
    - Sem planejamento prévio
    - Múltiplas vezes seguidas
    - Sem backup recente

    **Estratégia de Retenção:**
    - Defina política clara de retenção
    - Documente períodos por tipo de campanha
    - Considere requisitos legais/compliance
    - Mantenha logs de limpezas realizadas
    - Teste com períodos maiores primeiro

    **Automação:**
    - Agende limpezas via cron/scheduler
    - Monitore crescimento do banco
    - Implemente alertas de espaço
    - Mantenha registro de execuções
  </Accordion>
</AccordionGroup>

### Authorizations

<ParamField path="token" type="string" required>
  Token de autenticação de conexão com a API. <br />
  Exemplo: `zt_BppKZWtzvj1X2SbJAuOSkA0Z63uDBQ0wkb28NJaloKeOUnHk`
</ParamField>

### Body Parameters

<ParamField path="hours" type="integer">
  Período de retenção em horas. <br />
  Mensagens mais antigas são removidas. <br />
  Padrão: `168` (7 dias) <br />
  Exemplo: `720` (30 dias)
</ParamField>

<Info>
  A limpeza remove apenas mensagens com status "done" (enviadas com sucesso). Mensagens pendentes, agendadas ou com erro não são afetadas.
</Info>

<Warning>
  **Importante:** O processo é irreversível e executado de forma assíncrona. Não há como recuperar mensagens após a limpeza.
</Warning>

<RequestExample>
```bash cURL
curl -X POST https://zapclass.com.br/api/sender/cleardone \
  -H "Content-Type: application/json" \
  -H "Token: zt_BppKZWtzvj1X2SbJAuOSkA0Z63uDBQ0wkb28NJaloKeOUnHk" \
  -d '{
    "hours": 168
  }'
```

```javascript JavaScript
const response = await fetch("https://zapclass.com.br/api/sender/cleardone", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    Token: "zt_BppKZWtzvj1X2SbJAuOSkA0Z63uDBQ0wkb28NJaloKeOUnHk",
  },
  body: JSON.stringify({
    hours: 168 // 7 dias
  }),
});

const data = await response.json();
if (data.success) {
  console.log("Limpeza iniciada:", data.message);
}
```

```php PHP
<?php
$ch = curl_init('https://zapclass.com.br/api/sender/cleardone');

$payload = [
    "hours" => 168 // 7 dias
];

curl_setopt($ch, CURLOPT_POST, 1);
curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($payload));
curl_setopt($ch, CURLOPT_HTTPHEADER, [
    'Content-Type: application/json',
    'Token: zt_BppKZWtzvj1X2SbJAuOSkA0Z63uDBQ0wkb28NJaloKeOUnHk'
]);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);

$response = curl_exec($ch);
$data = json_decode($response, true);

if ($data['success']) {
    echo "Limpeza iniciada: {$data['message']}\n";
} else {
    echo "Erro: " . $data['message'];
}

curl_close($ch);
?>
```
</RequestExample>

<ResponseExample>
```json 200
{
  "success": true,
  "message": "Cleanup process started successfully",
  "cleanup": {
    "hours": 168,
    "days": 7,
    "cutoffDate": "2024-01-01T10:00:00.000Z",
    "status": "processing",
    "startedAt": 1672531200000
  }
}
```

```json 200
{
  "success": true,
  "message": "Cleanup process started successfully",
  "cleanup": {
    "hours": 720,
    "days": 30,
    "cutoffDate": "2023-12-08T10:00:00.000Z",
    "status": "processing",
    "startedAt": 1672531200000
  }
}
```

```json 400
{
  "success": false,
  "message": "O campo 'hours' deve ser um número inteiro positivo"
}
```

</ResponseExample>
